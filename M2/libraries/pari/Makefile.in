LICENSEFILES = README COPYING

# svn://pari.math.u-bordeaux.fr/pari/trunk

HOMEPAGE = http://pari.math.u-bordeaux.fr/
VPATH = @srcdir@

# pari maintainers have been known to break URL's, so we copy their software to another server:
# URL = http://pari.math.u-bordeaux.fr/pub/pari/unix

VERSION = 2.7.4-pre1
TARDIR = pari-2.7.4
# PATCHFILE = @abs_srcdir@/patch-$(VERSION)
URL = http://www.math.uiuc.edu/Macaulay2/Downloads/OtherSourceCode

CHECKTARGET = test-all

# we build only the shared library, because that's the version that is gmp compatible
INSTALLTARGET += install-include
BUILDTARGET += lib-dyn
INSTALLTARGET += install-lib-dyn
HOST_OS = @host_os@
HOST_CPU = @host_cpu@
ifeq ($(HOST_OS),mingw32)
HOST_OS = mingw
endif

ifneq (,$(findstring darwin,$(HOST_OS)))
# Pari's configure script gets confused if the host_os contains the version number, e.g., darwin14.0.0:
HOST_OS = darwin
endif

# a temporary kludge:
GMP_DIR = /mingw64

CONFIGURECMD = $(CONFIGENV) dfltlibdir=$(LIBRARIESDIR)/lib ./Configure --prefix=$(LIBRARIESDIR) --host=$(HOST_CPU)-$(HOST_OS) --with-gmp=$(GMP_DIR)

# Pari's configure script is needlessly confusing, since it's almost impossible to figure out what directory is chosen as the build directory.
# We've opted to search for the directory containing the file pari.cfg, hoping it's unique.

GETODIR  = `cd $(BUILDDIR) && find . -name pari.cfg | head -1 | sed 's=/[^/]*$$=='`
GETODIR2 = `find . -name pari.cfg | head -1 | sed 's=/[^/]*$$=='`

ifeq (@PROFILING@,yes)
CONFIGURECMD += -pg
INSTALLOPTIONS = -C $(GETODIR2)
BUILDOPTIONS = -C $(GETODIR2)
CHECKOPTIONS = -C $(GETODIR2)
else
ifeq (@DEBUG@,yes)
CONFIGURECMD += -g
INSTALLOPTIONS = -C $(GETODIR2)
BUILDOPTIONS = -C $(GETODIR2)
CHECKOPTIONS = -C $(GETODIR2)
else
INSTALLOPTIONS = -C $(GETODIR2)
BUILDOPTIONS = -C $(GETODIR2)
CHECKOPTIONS = -C $(GETODIR2)
endif
endif

include ../Makefile.library

# we have to detect which of these two answers it gives:
#   ### Building without GNU MP support
#   Using GNU MP, version 4.2.1
# config-chk: .config-checked-$(VERSION)
clean::; rm -f .config-checked-*
.config-checked-$(VERSION):
	: test whether pari successfully found gmp library during configuration :
	echo 'configfile(s) : '` find . -name pari.cfg `
	. $(GETODIR2)/pari.cfg && echo kernlvl1 = $$kernlvl1 && [ $$kernlvl1 = gmp ]
	: test whether pari found a dynamic library linker during configuration :
	. $(GETODIR2)/pari.cfg && echo DLLD = $$DLLD && [ "$$DLLD" != "" ]
	touch $@

Makefile: @srcdir@/Makefile.in ; cd ../.. && ./config.status libraries/pari/Makefile
run-example: example; ./example
example: example.c -lpari
example: CFLAGS += -Wall -Wno-unused -Werror -UNDEBUG
# Local Variables:
# compile-command: "make -C $M2BUILDDIR/libraries/pari "
# End:
